!function(){function e(){this.pool=new r,this.templates={},this.filters={},this.wrappers={}}function r(){this.store={}}function n(e){var r=0;for(var n in e)e.hasOwnProperty(n)&&(n=parseInt(n),n>r&&(r=n));return parseInt(r)}function t(e,r){var t=n(e)+1;return e[t]=r,t}function o(e,r){delete e[r]}function p(e){var r=0;for(var n in e)e.hasOwnProperty(n)&&r++;return r}e.prototype.foreach=function(e,r,n,i,s){var a,d,h,f=p(n);h=f-s.length;for(a in n)if(n.hasOwnProperty(a)){if(!(h-->0))break;n[a].remove()}d=0;for(a in n)n.hasOwnProperty(a)&&n[a].update(s[d++]);for(d=f,h=s.length;h>d;d++){var u=this.render(i);u.parent=e,e.children.push(u),u.appendTo(r),u.update(s[d]),a=t(n,u);var l=u.remove;u.remove=function(e,r){return function(){r(),o(n,e)}}(a,l)}},e.prototype.iftest=function(e,r,n,t,o,p){if(n.ref)p?n.ref.update(o):n.ref.remove();else if(p){var i=this.render(t);i.parent=e,e.children.push(i),i.appendTo(r),i.update(o),n.ref=i;var s=i.remove;i.remove=function(){s(),n.ref=null}}},e.prototype.render=function(e,r,n){if(n=n||!1,this.templates[e]){var t,o=this;return n?t=this.templates[e]():(t=this.pool.pull(e),t||(t=this.templates[e]())),t.parent=null,t.children=[],t.appendTo=function(e){for(var r=0,n=t.nodes.length;n>r;r++)if(8==e.nodeType){if(!e.parentNode)throw new Error("Can not insert child view into parent node.You need append your view first and then update.");e.parentNode.insertBefore(t.nodes[r],e)}else e.appendChild(t.nodes[r])},t.getDom=function(e){if(1==t.nodes.length)return t.nodes[0];for(var r=document.createDocumentFragment(),n=0,o=t.nodes.length;o>n;n++)r.appendChild(t.nodes[n]);return r},t.remove=function(){for(var r=t.nodes.length;r--;)t.nodes[r].parentNode.removeChild(t.nodes[r]);for(r=t.children.length;r--;)t.children[r].remove();t.parent&&(r=t.parent.children.indexOf(t),t.parent.children.splice(r,1)),o.pool.push(e,t)},void 0!==r&&t.update(r),t.wrapped=t.wrapped||{},this.wrappers[e]&&!t.wrapped[e]&&(t=this.wrappers[e](t),t.wrapped[e]=!0),t}throw new Error('Template with name "'+e+'" does not found.')},e.prototype.prerender=function(e,r){for(;r--;)this.pool.push(e,this.render(e,void 0,!0))},e.prototype.mount=function(e){var r=this;Object.keys(e).forEach(function(n){r.templates[n]=e[n]})},r.prototype.push=function(e,r){this.store[e]||(this.store[e]=[]),this.store[e].push(r)},r.prototype.pull=function(e){return this.store[e]?this.store[e].pop():void 0},"undefined"!=typeof module?module.exports=new e:window.monkberry=new e}();
